<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUKODA | Admin</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/svg+xml" href="assets/logo/icon-s-black.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        serif: ['Cormorant Garamond', 'Georgia', 'serif'],
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        black: '#111111',
                        paper: '#FAF8F5',
                        cream: '#F5F0EB',
                        accent: '#B8976A',
                        muted: '#8A8578',
                    },
                }
            }
        }
    </script>
    <style>
        body { background-color: #FAF8F5; color: #111; }
        .grid-line-b { border-bottom: 1px solid #E8E3DD; }
        [x-cloak] { display: none !important; }
        .accent-line { width: 40px; height: 1px; background: #B8976A; }
        .modal-backdrop { background: rgba(17, 17, 17, 0.4); backdrop-filter: blur(4px); }
        .slot-btn { transition: all 0.15s; }
        .slot-btn:hover { background: #B8976A; color: #fff; }
        .slot-btn.selected { background: #B8976A; color: #fff; }
    </style>
</head>
<body class="antialiased font-sans text-sm" x-data="adminApp()" x-init="init()">

    <div class="max-w-[1200px] mx-auto min-h-screen">

        <!-- Login -->
        <div x-show="!authenticated" x-cloak class="min-h-screen flex items-center justify-center px-4">
            <div class="max-w-sm w-full text-center">
                <h1 class="font-serif text-3xl font-light mb-2">SUKODA.</h1>
                <div class="accent-line mx-auto mb-8"></div>
                <p class="text-muted font-light mb-6">Admin paneel</p>
                <form @submit.prevent="login()">
                    <input type="password" x-model="password" placeholder="Parool" 
                        class="w-full border border-[#E8E3DD] bg-white px-4 py-3 text-center font-light outline-none focus:border-accent mb-4">
                    <button type="submit" class="w-full bg-accent text-white py-3 text-xs uppercase tracking-[0.2em] font-medium hover:bg-accent/90 transition-colors">
                        Sisene
                    </button>
                    <p x-show="loginError" class="mt-3 text-red-500 text-xs" x-text="loginError"></p>
                </form>
            </div>
        </div>

        <!-- Dashboard -->
        <div x-show="authenticated" x-cloak>

            <!-- Header -->
            <header class="grid-line-b py-4 px-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <h1 class="font-serif text-xl font-light">SUKODA.</h1>
                    <span class="text-[10px] uppercase tracking-[0.2em] text-accent font-medium">Admin</span>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="loadData()" class="text-xs text-muted hover:text-black transition-colors">Uuenda</button>
                    <button @click="authenticated = false; password = ''" class="text-xs text-muted hover:text-black transition-colors">Logi välja</button>
                </div>
            </header>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 grid-line-b">
                <div class="p-6 border-r border-[#E8E3DD]">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-muted mb-2">Tänased</p>
                    <p class="font-serif text-2xl font-light" x-text="todayBookings.length">0</p>
                </div>
                <div class="p-6 border-r border-[#E8E3DD]">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-muted mb-2">See nädal</p>
                    <p class="font-serif text-2xl font-light" x-text="weekBookings.length">0</p>
                </div>
                <div class="p-6 border-r border-[#E8E3DD]">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-muted mb-2">Aktiivsed tellijad</p>
                    <p class="font-serif text-2xl font-light" x-text="activeSubscriptions.length">0</p>
                </div>
                <div class="p-6">
                    <p class="text-[10px] uppercase tracking-[0.2em] text-muted mb-2">Tellimused kokku</p>
                    <p class="font-serif text-2xl font-light" x-text="allOrders.length">0</p>
                </div>
            </div>

            <!-- Tabs -->
            <div class="grid-line-b px-6 flex gap-6">
                <button @click="activeTab = 'today'" :class="activeTab === 'today' ? 'border-b-2 border-accent text-black' : 'text-muted'" class="py-4 text-xs uppercase tracking-[0.15em] transition-colors">
                    Tänased
                </button>
                <button @click="activeTab = 'week'" :class="activeTab === 'week' ? 'border-b-2 border-accent text-black' : 'text-muted'" class="py-4 text-xs uppercase tracking-[0.15em] transition-colors">
                    See nädal
                </button>
                <button @click="activeTab = 'subscriptions'" :class="activeTab === 'subscriptions' ? 'border-b-2 border-accent text-black' : 'text-muted'" class="py-4 text-xs uppercase tracking-[0.15em] transition-colors">
                    Tellimused
                </button>
                <button @click="activeTab = 'all'" :class="activeTab === 'all' ? 'border-b-2 border-accent text-black' : 'text-muted'" class="py-4 text-xs uppercase tracking-[0.15em] transition-colors">
                    Kõik tellimused
                </button>
            </div>

            <!-- Content -->
            <div class="p-6">

                <!-- Loading -->
                <div x-show="loading" class="py-12 text-center">
                    <div class="w-8 h-8 border border-accent border-t-transparent rounded-full animate-spin mx-auto"></div>
                </div>

                <!-- Today's Bookings -->
                <div x-show="activeTab === 'today' && !loading">
                    <h2 class="font-serif text-xl font-light mb-4">Tänased külastused</h2>
                    <template x-if="todayBookings.length === 0">
                        <p class="text-muted font-light py-8 text-center">Täna külastusi ei ole.</p>
                    </template>
                    <div class="space-y-3">
                        <template x-for="b in todayBookings" :key="b.id">
                            <div @click="openBookingDetail(b)" class="bg-white border border-[#E8E3DD] p-5 flex flex-col md:flex-row md:items-center gap-4 cursor-pointer hover:border-accent/50 transition-colors">
                                <div class="flex-1 min-w-0">
                                    <p class="font-medium" x-text="b.customerName"></p>
                                    <p class="text-muted text-xs mt-1 truncate" x-text="b.address"></p>
                                </div>
                                <div class="text-right shrink-0">
                                    <p class="font-serif text-lg" x-text="formatTime(b.scheduledAt)"></p>
                                    <p class="text-xs text-muted" x-text="getSizeName(b.size)"></p>
                                </div>
                                <div class="flex gap-2 shrink-0" @click.stop>
                                    <span x-show="b.status === 'scheduled'" class="px-3 py-1 bg-cream text-xs text-accent">Planeeritud</span>
                                    <span x-show="b.status === 'completed'" class="px-3 py-1 bg-green-50 text-xs text-green-600">Tehtud</span>
                                    <span x-show="b.status === 'cancelled'" class="px-3 py-1 bg-red-50 text-xs text-red-500">Tühistatud</span>
                                    <button x-show="b.status === 'scheduled'" @click="completeBooking(b.id)" class="px-3 py-1 bg-accent text-white text-xs hover:bg-accent/90">Tehtud</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Week's Bookings -->
                <div x-show="activeTab === 'week' && !loading">
                    <h2 class="font-serif text-xl font-light mb-4">Selle nädala graafik</h2>
                    <template x-if="weekBookings.length === 0">
                        <p class="text-muted font-light py-8 text-center">Sel nädalal külastusi ei ole.</p>
                    </template>
                    <div class="space-y-3">
                        <template x-for="b in weekBookings" :key="b.id">
                            <div @click="openBookingDetail(b)" class="bg-white border border-[#E8E3DD] p-5 flex flex-col md:flex-row md:items-center gap-4 cursor-pointer hover:border-accent/50 transition-colors">
                                <div class="w-24 text-center shrink-0">
                                    <p class="text-xs text-muted" x-text="formatDate(b.scheduledAt)"></p>
                                    <p class="font-serif text-lg" x-text="formatTime(b.scheduledAt)"></p>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="font-medium" x-text="b.customerName"></p>
                                    <p class="text-muted text-xs mt-1 truncate" x-text="b.address"></p>
                                </div>
                                <div class="flex gap-2 items-center shrink-0">
                                    <span class="text-xs text-muted" x-text="getSizeName(b.size)"></span>
                                    <span x-show="b.isAutoScheduled" class="px-2 py-0.5 bg-cream text-[10px] text-accent uppercase tracking-wider">Auto</span>
                                    <span x-show="b.status === 'scheduled'" class="w-2 h-2 rounded-full bg-accent"></span>
                                    <span x-show="b.status === 'completed'" class="w-2 h-2 rounded-full bg-green-500"></span>
                                    <span x-show="b.status === 'cancelled'" class="w-2 h-2 rounded-full bg-red-400"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Active Subscriptions -->
                <div x-show="activeTab === 'subscriptions' && !loading">
                    <h2 class="font-serif text-xl font-light mb-4">Aktiivsed tellimused</h2>
                    <template x-if="activeSubscriptions.length === 0">
                        <p class="text-muted font-light py-8 text-center">Aktiivseid tellimusi ei ole.</p>
                    </template>
                    <div class="space-y-3">
                        <template x-for="o in activeSubscriptions" :key="o.id">
                            <div @click="openOrderDetail(o)" class="bg-white border border-[#E8E3DD] p-5 cursor-pointer hover:border-accent/50 transition-colors">
                                <div class="flex flex-col md:flex-row md:items-center gap-4">
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium" x-text="o.customer?.name"></p>
                                        <p class="text-muted text-xs mt-1" x-text="o.customer?.email"></p>
                                    </div>
                                    <div class="text-right shrink-0">
                                        <p class="text-xs uppercase tracking-wider text-accent" x-text="getPackageName(o.package)"></p>
                                        <p class="text-xs text-muted mt-1" x-text="getSizeName(o.size)"></p>
                                    </div>
                                    <div class="text-right shrink-0">
                                        <p class="text-[10px] uppercase tracking-wider text-muted">Järgmine</p>
                                        <p class="text-xs" x-text="o.nextVisitDue ? formatDate(o.nextVisitDue) : 'Pole planeeritud'"></p>
                                    </div>
                                    <div class="text-right shrink-0">
                                        <p class="text-[10px] uppercase tracking-wider text-muted">Külastusi</p>
                                        <p class="font-serif text-lg" x-text="o.totalVisits || 0"></p>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- All Orders -->
                <div x-show="activeTab === 'all' && !loading">
                    <h2 class="font-serif text-xl font-light mb-4">Kõik tellimused</h2>
                    <div class="space-y-3">
                        <template x-for="o in allOrders" :key="o.id">
                            <div @click="openOrderDetail(o)" class="bg-white border border-[#E8E3DD] p-5 flex flex-col md:flex-row md:items-center gap-4 cursor-pointer hover:border-accent/50 transition-colors">
                                <div class="flex-1 min-w-0">
                                    <p class="font-medium" x-text="o.customer?.name"></p>
                                    <p class="text-muted text-xs mt-1" x-text="o.customer?.email"></p>
                                </div>
                                <div class="shrink-0">
                                    <span class="px-2 py-1 text-[10px] uppercase tracking-wider" :class="o.type === 'gift' ? 'bg-pink-50 text-pink-600' : 'bg-cream text-accent'" x-text="o.type === 'gift' ? 'Kingitus' : 'Tellimus'"></span>
                                </div>
                                <div class="text-xs text-muted shrink-0" x-text="getPackageName(o.package)"></div>
                                <div class="shrink-0">
                                    <span class="px-2 py-1 text-[10px] uppercase tracking-wider" :class="o.status === 'paid' ? 'bg-green-50 text-green-600' : o.status === 'cancelled' ? 'bg-red-50 text-red-500' : 'bg-gray-50 text-gray-500'" x-text="getStatusName(o.status)"></span>
                                </div>
                                <div class="text-xs text-muted shrink-0" x-text="o.createdAt ? new Date(o.createdAt).toLocaleDateString('et-EE') : ''"></div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================ -->
    <!-- BOOKING DETAIL MODAL -->
    <!-- ============================================================ -->
    <div x-show="showBookingModal" x-cloak class="fixed inset-0 z-50 flex items-start justify-center pt-12 md:pt-20 px-4" @keydown.escape.window="closeBookingModal()">
        <div class="modal-backdrop fixed inset-0" @click="closeBookingModal()"></div>
        <div class="relative bg-paper border border-[#E8E3DD] shadow-xl w-full max-w-lg max-h-[85vh] overflow-y-auto" x-show="showBookingModal" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
            
            <template x-if="selectedBooking">
                <div>
                    <!-- Header -->
                    <div class="p-6 grid-line-b flex justify-between items-start">
                        <div>
                            <p class="text-[10px] uppercase tracking-[0.2em] text-accent font-medium mb-1">Broneering</p>
                            <h3 class="font-serif text-2xl font-light" x-text="selectedBooking.customerName"></h3>
                        </div>
                        <button @click="closeBookingModal()" class="text-muted hover:text-black p-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>

                    <!-- Status -->
                    <div class="px-6 py-3 grid-line-b flex items-center gap-3">
                        <span class="px-3 py-1 text-xs" :class="selectedBooking.status === 'scheduled' ? 'bg-cream text-accent' : selectedBooking.status === 'completed' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-500'" x-text="selectedBooking.status === 'scheduled' ? 'Planeeritud' : selectedBooking.status === 'completed' ? 'Tehtud' : 'Tühistatud'"></span>
                        <span x-show="selectedBooking.isAutoScheduled" class="px-2 py-0.5 bg-cream text-[10px] text-accent uppercase tracking-wider">Auto-planeeritud</span>
                    </div>

                    <!-- Time & Address -->
                    <div class="px-6 py-5 grid-line-b">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-cream flex items-center justify-center shrink-0">
                                <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            </div>
                            <div>
                                <p class="font-medium" x-text="formatFullDate(selectedBooking.scheduledAt)"></p>
                                <p class="text-muted text-xs mt-1">
                                    <span x-text="formatTime(selectedBooking.scheduledAt)"></span>
                                    <span x-show="selectedBooking.endTime"> – <span x-text="formatTime(selectedBooking.endTime)"></span></span>
                                </p>
                            </div>
                        </div>
                        <div class="flex items-start gap-4 mt-4" x-show="selectedBooking.address">
                            <div class="w-10 h-10 bg-cream flex items-center justify-center shrink-0">
                                <svg class="w-5 h-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                            </div>
                            <div>
                                <p class="font-medium" x-text="selectedBooking.address"></p>
                                <p class="text-muted text-xs mt-1" x-text="getSizeName(selectedBooking.size)"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Client Info -->
                    <div class="px-6 py-5 grid-line-b">
                        <p class="text-[10px] uppercase tracking-[0.2em] text-muted font-medium mb-4">Kliendi andmed</p>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                <span x-text="selectedBooking.customerName"></span>
                            </div>
                            <div class="flex items-center gap-3" x-show="selectedBooking.customerEmail">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                <a :href="'mailto:' + selectedBooking.customerEmail" class="text-accent hover:underline" x-text="selectedBooking.customerEmail"></a>
                            </div>
                            <div class="flex items-center gap-3" x-show="selectedBooking.customerPhone">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                <a :href="'tel:' + selectedBooking.customerPhone" class="text-accent hover:underline" x-text="selectedBooking.customerPhone"></a>
                            </div>
                        </div>
                        <!-- Extra info from linked order -->
                        <template x-if="getLinkedOrder(selectedBooking)">
                            <div class="mt-4 pt-4 border-t border-[#E8E3DD]">
                                <div class="space-y-3">
                                    <div x-show="getLinkedOrder(selectedBooking)?.customer?.additionalInfo" class="text-xs text-muted">
                                        <p class="font-medium text-black mb-1">Lisainfo:</p>
                                        <p x-text="getLinkedOrder(selectedBooking)?.customer?.additionalInfo"></p>
                                    </div>
                                    <div class="flex items-center gap-2 text-xs">
                                        <span class="text-muted">Pakett:</span>
                                        <span class="text-accent font-medium" x-text="getPackageName(getLinkedOrder(selectedBooking)?.package)"></span>
                                    </div>
                                    <div x-show="getLinkedOrder(selectedBooking)?.totalVisits !== undefined" class="flex items-center gap-2 text-xs">
                                        <span class="text-muted">Külastusi kokku:</span>
                                        <span x-text="getLinkedOrder(selectedBooking)?.totalVisits || 0"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Reschedule Section (inline) -->
                    <div x-show="rescheduleMode" class="px-6 py-5 grid-line-b bg-cream/50">
                        <p class="text-[10px] uppercase tracking-[0.2em] text-accent font-medium mb-4">Muuda aega</p>
                        
                        <!-- Date range selector -->
                        <div class="flex items-center gap-3 mb-4">
                            <input type="date" x-model="slotStartDate" class="border border-[#E8E3DD] bg-white px-3 py-2 text-xs outline-none focus:border-accent">
                            <span class="text-muted text-xs">kuni</span>
                            <input type="date" x-model="slotEndDate" class="border border-[#E8E3DD] bg-white px-3 py-2 text-xs outline-none focus:border-accent">
                            <button @click="loadSlots()" class="px-3 py-2 bg-accent text-white text-xs hover:bg-accent/90">Otsi aegu</button>
                        </div>

                        <!-- Loading -->
                        <div x-show="slotsLoading" class="py-4 text-center">
                            <div class="w-6 h-6 border border-accent border-t-transparent rounded-full animate-spin mx-auto"></div>
                            <p class="text-xs text-muted mt-2">Otsin vabu aegu...</p>
                        </div>

                        <!-- Slots display -->
                        <div x-show="!slotsLoading && Object.keys(availableSlots).length > 0">
                            <template x-for="[date, times] in Object.entries(availableSlots)" :key="date">
                                <div class="mb-4">
                                    <p class="text-xs font-medium mb-2" x-text="formatFullDate(date + 'T12:00:00')"></p>
                                    <div class="flex flex-wrap gap-2">
                                        <template x-for="time in times" :key="time">
                                            <button @click="selectedSlot = time" class="slot-btn px-3 py-1.5 border border-[#E8E3DD] bg-white text-xs" :class="selectedSlot === time ? 'selected' : ''" x-text="formatTime(time)"></button>
                                        </template>
                                    </div>
                                </div>
                            </template>
                            
                            <div x-show="selectedSlot" class="mt-4 pt-4 border-t border-[#E8E3DD] flex items-center justify-between">
                                <p class="text-xs">
                                    Uus aeg: <strong x-text="selectedSlot ? formatFullDate(selectedSlot) + ', ' + formatTime(selectedSlot) : ''"></strong>
                                </p>
                                <button @click="confirmReschedule()" :disabled="rescheduleLoading" class="px-4 py-2 bg-accent text-white text-xs hover:bg-accent/90 disabled:opacity-50">
                                    <span x-show="!rescheduleLoading">Kinnita uus aeg</span>
                                    <span x-show="rescheduleLoading">Muudan...</span>
                                </button>
                            </div>
                        </div>

                        <div x-show="!slotsLoading && slotsSearched && Object.keys(availableSlots).length === 0" class="py-4 text-center">
                            <p class="text-xs text-muted">Vabu aegu ei leitud. Proovi teist perioodi.</p>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="px-6 py-5" x-show="selectedBooking.status === 'scheduled'">
                        <div class="flex flex-wrap gap-3">
                            <button @click="completeBooking(selectedBooking.id)" class="px-4 py-2 bg-accent text-white text-xs uppercase tracking-wider hover:bg-accent/90">
                                Märgi tehtuks
                            </button>
                            <button @click="toggleReschedule()" class="px-4 py-2 border border-[#E8E3DD] text-xs uppercase tracking-wider hover:border-accent hover:text-accent" :class="rescheduleMode ? 'border-accent text-accent' : ''">
                                Muuda aega
                            </button>
                            <button @click="cancelBookingWithReason(selectedBooking.id)" class="px-4 py-2 border border-[#E8E3DD] text-xs uppercase tracking-wider text-muted hover:border-red-300 hover:text-red-500">
                                Tühista
                            </button>
                        </div>
                        <p class="text-[10px] text-muted mt-3">Tühistamisel ja aja muutmisel saadetakse kliendile automaatselt email.</p>
                    </div>

                    <!-- Cancel reason display -->
                    <div class="px-6 py-4" x-show="selectedBooking.status === 'cancelled' && selectedBooking.cancelReason">
                        <p class="text-xs text-muted">Tühistamise põhjus: <span class="text-red-500" x-text="selectedBooking.cancelReason"></span></p>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- ============================================================ -->
    <!-- ORDER DETAIL MODAL -->
    <!-- ============================================================ -->
    <div x-show="showOrderModal" x-cloak class="fixed inset-0 z-50 flex items-start justify-center pt-12 md:pt-20 px-4" @keydown.escape.window="closeOrderModal()">
        <div class="modal-backdrop fixed inset-0" @click="closeOrderModal()"></div>
        <div class="relative bg-paper border border-[#E8E3DD] shadow-xl w-full max-w-lg max-h-[85vh] overflow-y-auto" x-show="showOrderModal" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-4" x-transition:enter-end="opacity-100 translate-y-0">
            
            <template x-if="selectedOrder">
                <div>
                    <!-- Header -->
                    <div class="p-6 grid-line-b flex justify-between items-start">
                        <div>
                            <p class="text-[10px] uppercase tracking-[0.2em] font-medium mb-1" :class="selectedOrder.type === 'gift' ? 'text-pink-500' : 'text-accent'" x-text="selectedOrder.type === 'gift' ? 'Kingitus' : 'Tellimus'"></p>
                            <h3 class="font-serif text-2xl font-light" x-text="selectedOrder.customer?.name"></h3>
                        </div>
                        <button @click="closeOrderModal()" class="text-muted hover:text-black p-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
                        </button>
                    </div>

                    <!-- Status & Package -->
                    <div class="px-6 py-4 grid-line-b flex items-center gap-3 flex-wrap">
                        <span class="px-3 py-1 text-xs" :class="selectedOrder.status === 'paid' ? 'bg-green-50 text-green-600' : selectedOrder.status === 'cancelled' ? 'bg-red-50 text-red-500' : 'bg-gray-50 text-gray-500'" x-text="getStatusName(selectedOrder.status)"></span>
                        <span class="text-xs text-accent font-medium" x-text="getPackageName(selectedOrder.package)"></span>
                        <span class="text-xs text-muted" x-text="getSizeName(selectedOrder.size)"></span>
                        <span x-show="selectedOrder.subscriptionStatus === 'active'" class="px-2 py-0.5 bg-green-50 text-[10px] text-green-600 uppercase tracking-wider">Aktiivne</span>
                    </div>

                    <!-- Client Info -->
                    <div class="px-6 py-5 grid-line-b">
                        <p class="text-[10px] uppercase tracking-[0.2em] text-muted font-medium mb-4">Tellija andmed</p>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                <span x-text="selectedOrder.customer?.name"></span>
                            </div>
                            <div class="flex items-center gap-3" x-show="selectedOrder.customer?.email">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                <a :href="'mailto:' + selectedOrder.customer?.email" class="text-accent hover:underline" x-text="selectedOrder.customer?.email"></a>
                            </div>
                            <div class="flex items-center gap-3" x-show="selectedOrder.customer?.phone">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                <a :href="'tel:' + selectedOrder.customer?.phone" class="text-accent hover:underline" x-text="selectedOrder.customer?.phone"></a>
                            </div>
                            <div class="flex items-start gap-3" x-show="selectedOrder.customer?.address">
                                <svg class="w-4 h-4 text-muted shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                <span x-text="selectedOrder.customer?.address"></span>
                            </div>
                            <div x-show="selectedOrder.customer?.additionalInfo" class="ml-7 text-xs text-muted bg-cream p-3 mt-2">
                                <p class="font-medium text-black mb-1">Lisainfo:</p>
                                <p x-text="selectedOrder.customer?.additionalInfo"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Gift Recipient -->
                    <div x-show="selectedOrder.type === 'gift' && selectedOrder.recipient" class="px-6 py-5 grid-line-b">
                        <p class="text-[10px] uppercase tracking-[0.2em] text-pink-500 font-medium mb-4">Kingisaaja</p>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                <span x-text="selectedOrder.recipient?.name"></span>
                            </div>
                            <div class="flex items-center gap-3" x-show="selectedOrder.recipient?.email">
                                <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                <span x-text="selectedOrder.recipient?.email"></span>
                            </div>
                            <div class="flex items-start gap-3" x-show="selectedOrder.recipient?.address">
                                <svg class="w-4 h-4 text-muted shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                <span x-text="selectedOrder.recipient?.address"></span>
                            </div>
                            <div x-show="selectedOrder.recipient?.message" class="ml-7 text-xs text-muted bg-pink-50 p-3 mt-2">
                                <p class="font-medium text-pink-600 mb-1">Sõnum:</p>
                                <p x-text="selectedOrder.recipient?.message" class="italic"></p>
                            </div>
                            <div x-show="selectedOrder.giftCode" class="ml-7">
                                <p class="text-xs text-muted">Kingituse kood: <span class="font-mono text-accent font-medium" x-text="selectedOrder.giftCode"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Subscription Details -->
                    <div x-show="selectedOrder.type === 'subscription'" class="px-6 py-5 grid-line-b">
                        <p class="text-[10px] uppercase tracking-[0.2em] text-muted font-medium mb-4">Tellimuse info</p>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-muted">Külastusi</p>
                                <p class="font-serif text-xl font-light" x-text="selectedOrder.totalVisits || 0"></p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-muted">Järgmine</p>
                                <p class="text-sm" x-text="selectedOrder.nextVisitDue ? formatDate(selectedOrder.nextVisitDue) : '-'"></p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-muted">Viimane külastus</p>
                                <p class="text-sm" x-text="selectedOrder.lastVisitAt ? formatDate(selectedOrder.lastVisitAt) : '-'"></p>
                            </div>
                            <div>
                                <p class="text-[10px] uppercase tracking-wider text-muted">Eelistatud aeg</p>
                                <p class="text-sm" x-text="selectedOrder.preferredTime || '-'"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Linked Bookings -->
                    <div class="px-6 py-5 grid-line-b">
                        <div class="flex items-center justify-between mb-4">
                            <p class="text-[10px] uppercase tracking-[0.2em] text-muted font-medium">Broneeringud</p>
                            <div x-show="orderBookingsLoading" class="w-4 h-4 border border-accent border-t-transparent rounded-full animate-spin"></div>
                        </div>
                        <div x-show="!orderBookingsLoading && orderBookings.length === 0" class="py-3 text-center">
                            <p class="text-xs text-muted">Broneeringuid ei ole.</p>
                        </div>
                        <div class="space-y-2">
                            <template x-for="b in orderBookings" :key="b.id">
                                <div @click="closeOrderModal(); $nextTick(() => openBookingDetail(b))" class="flex items-center gap-3 p-3 bg-white border border-[#E8E3DD] cursor-pointer hover:border-accent/50 transition-colors">
                                    <div class="shrink-0">
                                        <span class="w-2 h-2 rounded-full inline-block" :class="b.status === 'scheduled' ? 'bg-accent' : b.status === 'completed' ? 'bg-green-500' : 'bg-red-400'"></span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-xs font-medium" x-text="b.scheduledAt ? formatFullDate(b.scheduledAt) : '-'"></p>
                                        <p class="text-[11px] text-muted" x-text="b.scheduledAt ? formatTime(b.scheduledAt) + (b.endTime ? ' – ' + formatTime(b.endTime) : '') : ''"></p>
                                    </div>
                                    <div class="shrink-0">
                                        <span class="text-[10px] uppercase tracking-wider" :class="b.status === 'scheduled' ? 'text-accent' : b.status === 'completed' ? 'text-green-600' : 'text-red-500'" x-text="b.status === 'scheduled' ? 'Planeeritud' : b.status === 'completed' ? 'Tehtud' : 'Tühistatud'"></span>
                                    </div>
                                    <svg class="w-4 h-4 text-muted shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="px-6 py-5 grid-line-b" x-show="selectedOrder.status !== 'cancelled'">
                        <div class="flex flex-wrap gap-3">
                            <button @click="cancelOrderWithReason(selectedOrder.id)" class="px-4 py-2 border border-red-200 text-xs uppercase tracking-wider text-red-500 hover:bg-red-50 hover:border-red-300">
                                Tühista tellimus
                            </button>
                        </div>
                        <p class="text-[10px] text-muted mt-3">Tühistab tellimuse, kõik seotud broneeringud ja Stripe püsimakse. Kliendile saadetakse email.</p>
                    </div>

                    <!-- Cancel info -->
                    <div class="px-6 py-4 grid-line-b" x-show="selectedOrder.status === 'cancelled'">
                        <div class="flex items-start gap-2">
                            <svg class="w-4 h-4 text-red-400 shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>
                            <div>
                                <p class="text-xs text-red-500 font-medium">Tellimus tühistatud</p>
                                <p x-show="selectedOrder.cancelReason" class="text-xs text-muted mt-1" x-text="'Põhjus: ' + selectedOrder.cancelReason"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Order Meta -->
                    <div class="px-6 py-5">
                        <div class="flex flex-wrap gap-x-6 gap-y-2 text-xs text-muted">
                            <p>Loodud: <span x-text="selectedOrder.createdAt ? new Date(selectedOrder.createdAt).toLocaleString('et-EE') : '-'"></span></p>
                            <p x-show="selectedOrder.paidAt">Makstud: <span x-text="selectedOrder.paidAt ? new Date(selectedOrder.paidAt).toLocaleString('et-EE') : ''"></span></p>
                            <p class="text-[10px] font-mono opacity-50" x-text="'ID: ' + selectedOrder.id"></p>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <script>
    function adminApp() {
        return {
            password: '',
            authenticated: false,
            loginError: '',
            loading: false,
            activeTab: 'today',
            todayBookings: [],
            weekBookings: [],
            activeSubscriptions: [],
            allOrders: [],

            // Booking detail modal
            showBookingModal: false,
            selectedBooking: null,

            // Order detail modal
            showOrderModal: false,
            selectedOrder: null,
            orderBookings: [],
            orderBookingsLoading: false,

            // Reschedule
            rescheduleMode: false,
            availableSlots: {},
            selectedSlot: null,
            slotsLoading: false,
            slotsSearched: false,
            rescheduleLoading: false,
            slotStartDate: '',
            slotEndDate: '',

            packages: {
                moment: 'Üks Hetk', month: 'Kuu Aega', quarter: 'Kvartal Vabadust',
                once: 'Kord kuus', twice: 'Üle nädala', weekly: 'Iga nädal', test: 'Test'
            },
            sizes: { small: 'Kuni 50m²', medium: '51-90m²', large: '91-120m²', xlarge: '121-150m²' },
            statuses: { pending: 'Ootel', paid: 'Makstud', cancelled: 'Tühistatud' },

            async init() {
                const saved = sessionStorage.getItem('sukoda_admin');
                if (saved) {
                    this.password = saved;
                    await this.login();
                }
            },

            async login() {
                this.loginError = '';
                try {
                    const res = await fetch(`/api/admin/orders?password=${encodeURIComponent(this.password)}&limit=1`);
                    if (res.ok) {
                        this.authenticated = true;
                        sessionStorage.setItem('sukoda_admin', this.password);
                        await this.loadData();
                    } else {
                        this.loginError = 'Vale parool';
                    }
                } catch (e) {
                    this.loginError = 'Ühenduse viga';
                }
            },

            async loadData() {
                this.loading = true;
                try {
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    const tomorrowStr = new Date(today.getTime() + 86400000).toISOString().split('T')[0];
                    
                    const weekEnd = new Date(today);
                    weekEnd.setDate(weekEnd.getDate() + 7);
                    const weekEndStr = weekEnd.toISOString().split('T')[0];

                    const pw = encodeURIComponent(this.password);

                    const [todayRes, weekRes, ordersRes] = await Promise.all([
                        fetch(`/api/admin/bookings?start=${todayStr}&end=${tomorrowStr}&password=${pw}`),
                        fetch(`/api/admin/bookings?start=${todayStr}&end=${weekEndStr}&password=${pw}`),
                        fetch(`/api/admin/orders?password=${pw}&limit=50`),
                    ]);

                    if (todayRes.ok) {
                        const data = await todayRes.json();
                        this.todayBookings = data.bookings || [];
                    }
                    if (weekRes.ok) {
                        const data = await weekRes.json();
                        this.weekBookings = data.bookings || [];
                    }
                    if (ordersRes.ok) {
                        const data = await ordersRes.json();
                        this.allOrders = data.orders || [];
                        this.activeSubscriptions = this.allOrders.filter(o => 
                            o.type === 'subscription' && o.status === 'paid' && o.subscriptionStatus === 'active'
                        );
                    }
                } catch (e) {
                    console.error('Failed to load data:', e);
                }
                this.loading = false;
            },

            // ---- Booking Detail Modal ----

            openBookingDetail(booking) {
                this.selectedBooking = booking;
                this.showBookingModal = true;
                this.rescheduleMode = false;
                this.availableSlots = {};
                this.selectedSlot = null;
                this.slotsSearched = false;
            },

            closeBookingModal() {
                this.showBookingModal = false;
                this.selectedBooking = null;
                this.rescheduleMode = false;
            },

            getLinkedOrder(booking) {
                if (!booking?.orderId) return null;
                return this.allOrders.find(o => o.id === booking.orderId) || null;
            },

            // ---- Order Detail Modal ----

            async openOrderDetail(order) {
                this.selectedOrder = order;
                this.showOrderModal = true;
                this.orderBookings = [];
                this.orderBookingsLoading = true;

                // Load linked bookings
                const pw = encodeURIComponent(this.password);
                try {
                    const res = await fetch(`/api/admin/order-bookings?orderId=${order.id}&password=${pw}`);
                    if (res.ok) {
                        const data = await res.json();
                        this.orderBookings = data.bookings || [];
                    }
                } catch (e) {
                    console.error('Failed to load order bookings:', e);
                }
                this.orderBookingsLoading = false;
            },

            closeOrderModal() {
                this.showOrderModal = false;
                this.selectedOrder = null;
                this.orderBookings = [];
            },

            async cancelOrderWithReason(orderId) {
                const reason = prompt('Tellimuse tühistamise põhjus (valikuline).\n\nTühistab tellimuse, seotud broneeringud ja Stripe makse.\nKliendile saadetakse tühistamise email:');
                if (reason === null) return;
                try {
                    const res = await fetch('/api/admin/cancel-order', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ orderId, password: this.password, reason }),
                    });
                    if (res.ok) {
                        const data = await res.json();
                        const msg = data.cancelledBookings > 0
                            ? `Tellimus tühistatud. ${data.cancelledBookings} broneeringut tühistatud.`
                            : 'Tellimus tühistatud.';
                        alert(msg);
                        this.closeOrderModal();
                        await this.loadData();
                    } else {
                        const err = await res.json();
                        alert('Viga: ' + (err.error || 'Tundmatu viga'));
                    }
                } catch (e) {
                    console.error(e);
                    alert('Ühenduse viga');
                }
            },

            // ---- Actions ----

            async completeBooking(bookingId) {
                if (!confirm('Märgi külastus tehtuks?')) return;
                try {
                    const res = await fetch('/api/admin/complete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bookingId, password: this.password }),
                    });
                    if (res.ok) {
                        this.closeBookingModal();
                        await this.loadData();
                    } else {
                        alert('Viga: ' + (await res.json()).error);
                    }
                } catch (e) { console.error(e); alert('Ühenduse viga'); }
            },

            async cancelBookingWithReason(bookingId) {
                const reason = prompt('Tühistamise põhjus (valikuline).\nKliendile saadetakse tühistamise email:');
                if (reason === null) return;
                try {
                    const res = await fetch('/api/admin/cancel', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ bookingId, password: this.password, reason }),
                    });
                    if (res.ok) {
                        this.closeBookingModal();
                        await this.loadData();
                    } else {
                        alert('Viga: ' + (await res.json()).error);
                    }
                } catch (e) { console.error(e); alert('Ühenduse viga'); }
            },

            // ---- Reschedule ----

            toggleReschedule() {
                this.rescheduleMode = !this.rescheduleMode;
                if (this.rescheduleMode) {
                    // Default: next 2 weeks
                    const start = new Date();
                    start.setDate(start.getDate() + 1);
                    const end = new Date();
                    end.setDate(end.getDate() + 15);
                    this.slotStartDate = start.toISOString().split('T')[0];
                    this.slotEndDate = end.toISOString().split('T')[0];
                    this.availableSlots = {};
                    this.selectedSlot = null;
                    this.slotsSearched = false;
                }
            },

            async loadSlots() {
                if (!this.selectedBooking) return;
                this.slotsLoading = true;
                this.slotsSearched = false;
                this.availableSlots = {};
                this.selectedSlot = null;

                const eventTypeSlug = this.selectedBooking.eventTypeSlug || this.getEventTypeSlug(this.selectedBooking.size);
                const pw = encodeURIComponent(this.password);

                try {
                    const res = await fetch(`/api/admin/slots?eventTypeSlug=${eventTypeSlug}&startDate=${this.slotStartDate}&endDate=${this.slotEndDate}&password=${pw}`);
                    if (res.ok) {
                        const data = await res.json();
                        this.availableSlots = data.slots || {};
                    } else {
                        const err = await res.json();
                        alert('Viga aegade laadimisel: ' + (err.error || 'Tundmatu viga'));
                    }
                } catch (e) {
                    console.error(e);
                    alert('Ühenduse viga aegade laadimisel');
                }
                this.slotsLoading = false;
                this.slotsSearched = true;
            },

            async confirmReschedule() {
                if (!this.selectedSlot || !this.selectedBooking) return;

                const newDate = new Date(this.selectedSlot);
                const confirmMsg = `Muuda visiidi aeg:\n\n${this.formatFullDate(this.selectedBooking.scheduledAt)}, ${this.formatTime(this.selectedBooking.scheduledAt)}\n→ ${this.formatFullDate(this.selectedSlot)}, ${this.formatTime(this.selectedSlot)}\n\nKliendile saadetakse teavitus email.`;
                
                if (!confirm(confirmMsg)) return;

                this.rescheduleLoading = true;
                try {
                    const res = await fetch('/api/admin/reschedule', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            bookingId: this.selectedBooking.id,
                            newStartTime: this.selectedSlot,
                            password: this.password,
                        }),
                    });
                    if (res.ok) {
                        this.closeBookingModal();
                        await this.loadData();
                    } else {
                        const err = await res.json();
                        alert('Viga aja muutmisel: ' + (err.error || 'Tundmatu viga'));
                    }
                } catch (e) {
                    console.error(e);
                    alert('Ühenduse viga');
                }
                this.rescheduleLoading = false;
            },

            getEventTypeSlug(size) {
                const slugs = { small: 'koristus-50', medium: 'koristus-90', large: 'koristus-120', xlarge: 'koristus-150' };
                return slugs[size] || 'koristus-90';
            },

            // ---- Formatting ----

            formatTime(isoStr) {
                if (!isoStr) return '';
                const d = new Date(isoStr);
                return d.toLocaleTimeString('et-EE', { hour: '2-digit', minute: '2-digit' });
            },

            formatDate(isoStr) {
                if (!isoStr) return '';
                const d = new Date(isoStr);
                return d.toLocaleDateString('et-EE', { day: 'numeric', month: 'short' });
            },

            formatFullDate(isoStr) {
                if (!isoStr) return '';
                const d = new Date(isoStr);
                const days = ['Pühapäev', 'Esmaspäev', 'Teisipäev', 'Kolmapäev', 'Neljapäev', 'Reede', 'Laupäev'];
                return `${days[d.getDay()]}, ${d.toLocaleDateString('et-EE', { day: 'numeric', month: 'long', year: 'numeric' })}`;
            },

            getPackageName(pkg) { return this.packages[pkg] || pkg || ''; },
            getSizeName(size) { return this.sizes[size] || size || ''; },
            getStatusName(status) { return this.statuses[status] || status || ''; },
        };
    }
    </script>
</body>
</html>
